<!DOCTYPE html>
<html>
<head>
  <title>Chat U. Guayaquil</title>
  <style>
    /* Dise침o General */
    body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background: #e5ddd5; display: flex; height: 100vh; }
    
    /* Barra Lateral de Usuarios */
    #sidebar { width: 250px; background: #075e54; color: white; padding: 20px; display: flex; flex-direction: column; }
    #sidebar h3 { margin-top: 0; border-bottom: 1px solid #ffffff50; padding-bottom: 10px; }
    #lista-usuarios { list-style: none; padding: 0; }
    #lista-usuarios li { padding: 8px 0; border-bottom: 1px solid #ffffff20; font-size: 0.9em; }
    #lista-usuarios li::before { content: "游릭 "; }

    /* 츼rea del Chat */
    #main { flex-grow: 1; display: flex; flex-direction: column; }
    #mensajes { flex-grow: 1; list-style-type: none; margin: 0; padding: 20px; overflow-y: scroll; display: flex; flex-direction: column; gap: 10px; }
    
    /* Burbujas de Mensaje */
    .mensaje { background: white; padding: 10px 15px; border-radius: 0 10px 10px 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); max-width: 70%; align-self: flex-start; }
    .mensaje strong { color: #075e54; display: block; font-size: 0.8em; margin-bottom: 4px; }
    .sistema { align-self: center; background: #dcf8c6; border-radius: 20px; font-size: 0.8em; padding: 5px 15px; color: #555; }

    /* Formulario de env칤o */
    form { background: #f0f0f0; padding: 10px; display: flex; gap: 10px; }
    input { flex-grow: 1; padding: 12px; border: 1px solid #ccc; border-radius: 20px; outline: none; }
    button { padding: 10px 25px; background: #075e54; color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; }
    button:hover { background: #128c7e; }
  </style>
</head>
<body>

  <div id="sidebar">
    <h3>游논 Usuarios</h3>
    <ul id="lista-usuarios"></ul>
  </div>

  <div id="main">
    <ul id="mensajes"></ul>
    <form id="formulario" action="">
      <input id="input" autocomplete="off" placeholder="Escribe un mensaje..." />
      <button>Enviar</button>
    </form>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();

    // 1. Pedir nombre al usuario apenas entra
    const nombreUsuario = prompt("Por favor, ingresa tu nombre para entrar al chat:");
    if (nombreUsuario) {
        socket.emit('nuevo_usuario', nombreUsuario);
    } else {
        socket.emit('nuevo_usuario', "An칩nimo"); // Si cancela, entra como An칩nimo
    }

    var form = document.getElementById('formulario');
    var input = document.getElementById('input');
    var listaMsj = document.getElementById('mensajes');

    // Enviar mensaje
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      if (input.value) {
        socket.emit('mensaje_chat', input.value);
        input.value = '';
      }
    });

    // Recibir mensajes de texto
    socket.on('mensaje_chat', function(data) {
      var item = document.createElement('li');
      item.className = 'mensaje';
      item.innerHTML = `<strong>${data.usuario}</strong> ${data.texto}`;
      listaMsj.appendChild(item);
      window.scrollTo(0, document.body.scrollHeight);
    });

    // Recibir mensajes del sistema (entradas/salidas)
    socket.on('mensaje_sistema', function(texto) {
      var item = document.createElement('li');
      item.className = 'sistema';
      item.textContent = texto;
      listaMsj.appendChild(item);
    });

    // Actualizar la lista de usuarios conectados (barra lateral)
    socket.on('actualizar_lista', function(usuarios) {
      var lista = document.getElementById('lista-usuarios');
      lista.innerHTML = ""; // Limpiar lista actual
      usuarios.forEach(user => {
        var li = document.createElement('li');
        li.textContent = user;
        lista.appendChild(li);
      });
    });
  </script>
</body>
</html>